<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>{{title}}</title>
  <link rel="stylesheet" href="/static/stylesheets/normalize.css" />
  <link rel='stylesheet' href='/static/stylesheets/layout.css' />
  <link rel='stylesheet' href='/static/stylesheets/sign.css' />
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
</head>

<body>
  <div class="g-container">
    <div class="g-signup">
      <div class="form-auto">
        <div class="form-header">
          <a href="/signup">Sign up</a>
          <a href="javascript: void()" class="form-on">Sign in</a>
        </div>
        <form name="signin">
          <div class="from-row">
            <label for="email" class="from-label">E-mail</label>
            <input type="email" id="email" name="email" class="from-input" required />
          </div>
          <div class="from-row">
            <label for="pwd" class="from-label">Password</label>
            <input type="password" id="pwd" name="pwd" class="from-input" required />
          </div>
          <div class="from-row">
            <button type="submit" class="from-btn">Sign in</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  {{!-- message --}}
    {{#if msg}}
    <div class="m-msg">
      {{msg.text}}
    </div>
    {{/if}}
  <script>
    // 表单提交
    const submitBtn = document.getElementsByClassName('from-btn')[0];
    submitBtn.addEventListener('click', (e) => {
      e.preventDefault()
      let email = document.signin.email.value
      let pwd = document.signin.pwd.value
      let data = { params: { email, pwd } }
      axios.get('/signin/verify', data).then((r) => {
        console.log(r.data);
        let { result, msg} = r.data
        if (result === 1) {
          // axios.defaults.headers.common['Authorization'] = r.data.token
          Msg(msg, result)
          localStorage.setItem(toString(r.data.admin)+"ex09_t", r.data.token);
          //window.location = '/';
        } else Msg(msg)
      });
    });

    // 信息弹窗
    let Msg = function (txt, status = 0, timeout = 3000) {
      const color = status ? '#68af02' : 'red';
      let msgDiv = document.createElement('DIV');
      let content = document.createTextNode(txt);
      msgDiv.classList.add('m-msg');
      msgDiv.appendChild(content);
      msgDiv.style.animationDuration = timeout / 1000 + 's';
      msgDiv.style.backgroundColor = color;
      document.body.appendChild(msgDiv);
      setTimeout(() => document.body.removeChild(msgDiv), timeout);
    }
    const msgDiv = document.getElementsByClassName('m-msg')[0];
    console.log(msgDiv)
    if (msgDiv) setTimeout(() => document.body.removeChild(msgDiv), 2000);
  </script>
  <script src="/static/javascripts/axios.min.map.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
</body>

</html>